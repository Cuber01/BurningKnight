name: Build BurningKnight
on:
  push:
    branches:
      - dev

jobs:
  build:
    name: Setup test pack
    runs-on: windows-latest
    steps:
      - name: Setup stuff
        shell: bash
        run: |
         mkdir linux
         echo "test">linux/homework.txt
      - name: Push stuff
        uses: actions/upload-artifact@v1
        with:
          name: linux
          path: linux

  upload:
    needs: build
    name: Build BurningKnight
    runs-on: ubuntu-18.04
    steps:
      - name: Download result
        uses: actions/download-artifact@v1
        with:
          name: linux
      - name: Test
        shell: bash
        run: |
          ls linux/
      - name: Upload depots to steam
        shell: bash
        run: |
           git clone "https://${{ secrets.GITHUB_KEY }}@github.com/egordorichev/steam_builder.git"
           mkdir Linux
           mkdir Windows
           mkdir Macos
           echo "lin">>Linux/hi
           echo "win">>Windows/hi
           echo "mac">>Macos/hi
           mkdir ~/.steam/steam/ -p
           cp ./steam_builder/ssfn2631791037380626867 ~/.steam/steam/
           ls -l ~/.steam/steam
           mkdir -p ./steam_builder/tools/ContentBuilder/builder/public/
           cp ./steam_builder/steambootstrapper_english.txt ./steam_builder/tools/ContentBuilder/builder/public/
           ls -l ./steam_builder/tools/ContentBuilder/builder/public/
           cd steam_builder/tools/ContentBuilder
           mkdir ./content/Windows
           cp ../../../Windows/* ./content/Windows/
           mkdir ./content/Linux
           cp ../../../Linux/* ./content/Linux/
           mkdir ./content/Macos
           cp ../../../Macos/* ./content/Macos/
           chmod a+x builder_linux/steamcmd.sh
           chmod a+x builder_linux/linux32/steamcmd
           builder_linux/steamcmd.sh +login "${{ secrets.STEAM_USERNAME }}" "${{ secrets.STEAM_PASSWORD }}" +run_app_build_http ../scripts/app_build_851150.vdf +quit
           
